#!/usr/bin/perl
use diagnostics;
use strict;
use warnings;
use Redis::Client;
my $client = Redis::Client->new( host => 'localhost', port => 6379 );

$client->del('iphashes');

#my $nas = '192.168.1.2';
my $nas=`/etc/scripts/inputIP`;
chomp($nas);

my $oid         = ".1.3.6.1.4.1.14179.2.1.4.1";
my @snmpIPinfo  = `/usr/bin/snmpwalk -v 2c -c public $nas $oid`;

my @MACslist = grep{/(3.6.1.4.1.14179.2.1.4.1.1\.)/} @snmpIPinfo;
#my @MACs = `echo '@MAC' | cut -d ':' -f2`;
my @MACDeclist;

my $plimit = scalar(@MACslist);
my @split;
my @values;
for (my $p =0 ; $p < $plimit ; $p++)
{
        $MACDeclist[$p] = substr("$MACslist[$p]",30);
	@split = split /=/,$MACDeclist[$p];
	$values[$p] = $split[0];
}



my $i=0;

my @IPlist;


#iso.3.6.1.4.1.14179.2.1.4.1.2.8.237.185.47.180.88 = IpAddress: 192.168.1.22
#iso.3.6.1.4.1.14179.2.1.4.1.2.24.244.106.26.177.85 = IpAddress: 192.168.1.26
#iso.3.6.1.4.1.14179.2.1.4.1.2.64.44.244.57.8.167 = IpAddress: 192.168.1.20
#iso.3.6.1.4.1.14179.2.1.4.1.2.84.39.30.10.43.73 = IpAddress: 192.168.1.25
#iso.3.6.1.4.1.14179.2.1.4.1.2.104.93.67.159.17.199 = IpAddress: 192.168.1.27
#iso.3.6.1.4.1.14179.2.1.4.1.2.132.122.136.139.60.206 = IpAddress: 192.168.1.29
#iso.3.6.1.4.1.14179.2.1.4.1.2.144.253.97.9.144.132 = IpAddress: 192.168.1.28
#iso.3.6.1.4.1.14179.2.1.4.1.2.208.51.17.115.8.205 = IpAddress: 192.168.1.12
#iso.3.6.1.4.1.14179.2.1.4.1.2.232.80.139.145.134.125 = IpAddress: 192.168.1.14


#8.237.185.47.180.88 
#24.244.106.26.177.85 
#64.44.244.57.8.167 
#84.39.30.10.43.73 
#104.93.67.159.17.199 
#132.122.136.139.60.206 
#144.253.97.9.144.132 
#208.51.17.115.8.205 
#232.80.139.145.134.125

my @ip;
my @IPinfo;


foreach  my $value(@values){

#print "$value\n";
push (@IPinfo, grep{/(3.6.1.4.1.14179.2.1.4.1.2.$value)/} @snmpIPinfo);

}


foreach my $ipvalue(@IPinfo){

#print $ipvalue;

@ip = split /:/, $ipvalue;
push(@IPlist,$ip[1]);

}

print @IPlist;
