#!/usr/bin/perl
use diagnostics;
use strict;
use warnings;

# test scriptje dat nog uitgebreid moet worden.

my $IP	 =".1.3.6.1.4.1.14179.2.1.4.1.2"; #$bsnMobileStationIpAddress 
my @snmpgetinfoIP = `/usr/bin/snmpwalk -v 2c -c public 192.168.1.2 $IP | cut -d ' ' -f4`;

#print @snmpgetinfoIP;

my $MAC =  ".1.3.6.1.4.1.14179.2.1.4.1.1"; #bsnMobileStationMacAddress
my @snmpgetinfoMAC = `/usr/bin/snmpwalk -v 2c -c public 192.168.1.2 $MAC | cut -d ':' -f2`;

#print @snmpgetinfoMAC;

my $Ssid = ".1.3.6.1.4.1.14179.2.1.4.1.7"; #bsnMobileStationSsid
my @snmpgetinfoSsid = `/usr/bin/snmpwalk -v 2c -c public 192.168.1.2 $Ssid |cut -d '"' -f2 `;

#print @snmpgetinfoAPSsid;

my $APMacAddress= ".1.3.6.1.4.1.14179.2.1.4.1.4"; #bsnMobileStationAPMacAddr
my @snmpgetinfoAPMacAddress = `/usr/bin/snmpwalk -v 2c -c public 192.168.1.2 $APMacAddress | cut -d ':' -f2`;

# dit is het Base Radio MAC
#  bsnAPDot3MacAddress	1.3.6.1.4.1.14179.2.2.1.1.1   vergelijken hiermee en zo de APname bepalen?
#Test voor het weergeven van AP Name
my $APName = ".1.3.6.1.4.1.14179.2.2.1.1.3"; #bsnAPName
my @snmpAPName = `/usr/bin/snmpwalk -v 2c -c public 192.168.1.2 $APName |cut -d '"' -f2 `;

my $APDot3MacAddress = ".1.3.6.1.4.1.14179.2.2.1.1.1"; # bsnAPDot3MacAddress
my @snmpDot3MacAddress = `/usr/bin/snmpwalk -v 2c -c public 192.168.1.2 $APDot3MacAddress |cut -d ':' -f2 `;

my $end = scalar(@snmpAPName);

my %hashAP;
for(my $j=0;$j< $end; $j++){
	chomp($snmpDot3MacAddress[$j]);
	chomp($snmpAPName[$j]);
	$hashAP{$snmpDot3MacAddress[$j]} = "$snmpAPName[$j]";
}


# niet zeker wat dit juist doet ? 

#my $protocol= ".1.3.6.1.4.1.14179.2.1.4.1.25" ; #bsnMobileStationProtocol 
#my @snmpgetinfoProtocol = `/usr/bin/snmpwalk -v 2c -c public 192.168.1.2 $protocol`;
#print "@snmpgetinfoProtocol";


my $bytesreceived = ".1.3.6.1.4.1.14179.2.1.6.1.2";
my @snmpgetinfoBytesReceived = `/usr/bin/snmpwalk -v 2c -c public 192.168.1.2 $bytesreceived | cut -d ':' -f2`;
#print "@snmpgetinfoBytesReceived";

my $bytessent = ".1.3.6.1.4.1.14179.2.1.6.1.2";
my @snmpgetinfoBytesSent = `/usr/bin/snmpwalk -v 2c -c public 192.168.1.2 $bytessent | cut -d ':' -f2`;
#print "@snmpgetinfoBytesSent";


# om een overzicht te maken
# -> $snmpgetinfoIP $snmpgetinfoAPSsid $snmpgetinfoAPMacAddress omzetten in array 
# for loop 

#HTML probeersel

print "<!DOCTYPE html>\n";
print "<html>\n";
print "<body>\n";
print "<table border='1' style='width:100%'>\n";
print "<tr>\n";
print "<td>IP-address</td>\n";
print "<td>MAC-address </td>\n";
print "<td>SSID</td>\n";		
print "<td>MAC-AP (Base Radio MAC)</td>\n";
print "<td>APName</td>\n";		
print "</tr>\n";

my $limit = scalar(@snmpgetinfoIP);


for(my $i=0 ; $i < $limit ; $i++) {
	
	chomp($snmpgetinfoIP[$i]);
	chomp($snmpgetinfoMAC[$i]);
	chomp($snmpgetinfoSsid[$i]);
	chomp($snmpgetinfoAPMacAddress[$i]);
	
	print "\n";
	print "<tr>";
	print "<td> $snmpgetinfoIP[$i]</td>";
	print "<td> $snmpgetinfoMAC[$i] </td>";
	print "<td><a href='/toonclientsperssid.php?SSID=$snmpgetinfoSsid[$i]'>$snmpgetinfoSsid[$i]</a></td>";
	print "<td>$snmpgetinfoAPMacAddress[$i]</td>";
	print "<td> <a href='/toonclientsperap.php?AP=$hashAP{$snmpgetinfoAPMacAddress[$i]}'>$hashAP{$snmpgetinfoAPMacAddress[$i]}</td>";
	print "</tr>";
}

print "\n</table>\n";
print "</body>\n";
print "</html>\n";

